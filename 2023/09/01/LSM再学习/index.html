<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="LSMå†å­¦ä¹ -Compactionä¸Write stalls" />
    <meta name="hexo-theme-A4" content="v1.8.8" />
    <link rel="alternate icon" type="image/webp" href="/img/frog.png">
    <title>HappyFishingTime | å¿«ä¹çš„æ‘¸é±¼æ—¶åˆ»</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.1.1"></head>
    
    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/frog.png" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">HappyFishingTime</a> 
            <span class="description">æ‘¸é±¼å¹»â™‚æƒ³â™‚ä¹¡ï¼Œè®ºæ–‡ã€æŠ€æœ¯æ€»ç»“ä¸ç‰¢éªš</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/project/">æ‘¸é±¼é¡¹ç›®</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            LSMå†å­¦ä¹ -Compactionä¸Write stalls
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#LSM%E5%86%8D%E5%AD%A6%E4%B9%A0"><span class="post-toc-text">LSMå†å­¦ä¹ </span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-compaction%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="post-toc-text">1. compactionçš„ç±»å‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-Level-compaction"><span class="post-toc-text">1.1 Level compaction</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-x-Sub-compaction"><span class="post-toc-text">1.x Sub-compaction</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-%E5%86%99%E5%BB%B6%E8%BF%9F-Write-stalls"><span class="post-toc-text">2. å†™å»¶è¿Ÿ(Write stalls)</span></a></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p><strong>å†™åœ¨å‰é¢ï¼š</strong></p>
<p>é¢è¯•å’Œç»„é‡Œçš„åŒé—¨æ’è½¦äº†ï¼Œä¸€èˆ¬ä¸€æ¬¡æ‹›è˜ä¸ä¼šè¦åŒä¸€æ¥æºçš„ä¸¤ä¸ªäººï¼Œä½œä¸ºåæ¥è€…ï¼Œæ„Ÿè§‰é¢è¯•å®˜é¢åˆ°æˆ‘å·²ç»å®Œå…¨ä¸è®¤çœŸäº†ï¼Œé—®æˆ‘çš„é—®é¢˜ä¹Ÿæ¯”é—®åŒé—¨çš„éš¾å‡ ä¸ªlevelï¼Œè€Œä¸”å®Œå…¨æ²¡åœ¨å¬æˆ‘çš„è‡ªæˆ‘ä»‹ç»ï¼Œåœ¨æˆ‘è®²å®ä¹ çš„æ—¶å€™ä¹Ÿåœ¨åŠå…¬æ²¡ç†æˆ‘ï¼Œç”šè‡³è¿˜è®©æˆ‘ç­‰äº†ä»–å¥½ä¹…ã€‚</p>
<p>ä¸è¿‡ä»–é—®çš„ä¸€äº›é—®é¢˜è™½ç„¶å¸¸è§„ï¼Œå´ä¹Ÿç¡®å®é—®ä½æˆ‘äº†ï¼Œå®ä¹ ç¼çº«æœºè¸©ä¹…äº†ï¼ŒKVå­˜å‚¨å¼•æ“å¿˜å®Œäº†ï¼Œåœ¨æ­¤åšä¸€ä¸‹åæ€å­¦ä¹ ï¼Œä¸ä¼š&#x2F;å¿˜äº†çš„é—®é¢˜ï¼š</p>
<ol>
<li>å†™å»¶è¿Ÿçš„æˆå› ï¼Œæ²¡å›ç­”å…¨ï¼Œåªè®°å¾—å†writeä¸­çš„makeroomå‡½æ•°ä¸­ï¼Œå…·ä½“æœ‰å“ªäº›å·²ç»å¿˜è®°äº†ï¼Œåªå›ç­”äº†leveldbçš„immutable memtableçš„ä¸‹åˆ·ã€L0å±‚sstableè¿‡å¤šã€‚</li>
<li>LSM treeä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸ºé«˜äºä¸¤å±‚ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>c++ dequeçš„åº•å±‚å®ç°</li>
</ol>
<h1 id="LSMå†å­¦ä¹ "><a href="#LSMå†å­¦ä¹ " class="headerlink" title="LSMå†å­¦ä¹ "></a>LSMå†å­¦ä¹ </h1><p>ä»¥æˆ‘çš„ç†è§£è€Œè¨€ï¼Œä»¥LSM treeä½œä¸ºå­˜å‚¨ç»“æ„çš„å¼•æ“ï¼Œæé«˜æ€§èƒ½çš„è¦ç‚¹åœ¨äºlogä¸sortçš„å¹³è¡¡ï¼Œsortçš„æ ¸å¿ƒåœ¨äºcompaction</p>
<h2 id="1-compactionçš„ç±»å‹"><a href="#1-compactionçš„ç±»å‹" class="headerlink" title="1. compactionçš„ç±»å‹"></a>1. compactionçš„ç±»å‹</h2><p>rocksdbæ”¯æŒå¤šç§ä¸åŒçš„compactionç®—æ³•ï¼šLeveled compactionã€Tiered compactionã€FIFO compaction</p>
<h3 id="1-1-Level-compaction"><a href="#1-1-Level-compaction" class="headerlink" title="1.1 Level compaction"></a>1.1 Level compaction</h3><p>å‚è€ƒè‡ª<a target="_blank" rel="noopener" href="https://github.com/facebook/rocksdb/wiki/Leveled-Compaction">rocksdbçš„wiki</a></p>
<p>åœ¨Disk é‡Œé¢ç»´æŒäº†å¤šçº§levelçš„SStableï¼Œè€Œä¸”æ¯å±‚ç»´æŒâ€œ<strong>å”¯ä¸€ä¸€ä¸ª</strong>â€ <strong>â€œRunâ€</strong>ã€‚</p>
<p>Runçš„ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>SSTableæœ‰åº</li>
<li>SSTableçš„rangeæ²¡æœ‰äº¤é›†</li>
</ol>
<p>å±‚çš„åˆ’åˆ†æ˜¯ä»¥sizeä¸ºæ ‡å‡†çš„ï¼ŒL<del>n+1</del>.size() &#x3D; 10 * L<del>n</del>.size()ï¼Œå½“å±‚ä¸­sstableçš„æ€»sizeè¶…è¿‡å¤§å°åˆ™è§¦å‘å‘ä¸‹çš„compaction</p>
<ul>
<li><strong>L0 -&gt; L1</strong></li>
</ul>
<p>å½“L0sstableçš„æ•°é‡åˆ°è¾¾é¢„å®šå€¼æ—¶è§¦å‘ï¼Œä¸€èˆ¬ä¼šé€‰ä¸­<strong>å…¨éƒ¨</strong>L0å±‚çš„sstableè¿›è¡Œcompactionï¼Œå‘L1å±‚é‡å çš„sstableåˆå¹¶ã€‚</p>
<p><a href="/img/2023-9/L0.png" title="L0" class="gallery-item" style="box-shadow: none;"> <img src="/img/2023-9/L0.png" alt="L0"></a></p>
<p>è¿™é‡Œçš„åˆå¹¶ä¸€èˆ¬æ˜¯å•çº¿ç¨‹çš„ï¼Œå› æ­¤å¯èƒ½æ˜¯ç“¶é¢ˆï¼Œä¹Ÿæœ‰åº”å¯¹ç­–ç•¥ï¼Œå«åšsub-compactionï¼Œè¿™ç§åº”å¯¹ç­–ç•¥ä¸æ˜¯ä¸“ä¸ºæ­¤ç§åœºæ™¯è®¾è®¡çš„ï¼Œæ‰€æœ‰æ¯”è¾ƒé‡çš„compactionä»»åŠ¡éƒ½å¯ä»¥åšsub-compactionæ‹†åˆ†ï¼Œä½†æ˜¯æ­¤åŠŸèƒ½æ˜¯é»˜è®¤å…³é—­çš„ï¼Œè¯¦è§åé¢ã€‚</p>
<ul>
<li><strong>Ln -&gt; Ln+1</strong></li>
</ul>
<p>å¦‚æœLnå±‚çš„sstableè¶…è¿‡äº†é¢„å®šçš„sizeï¼Œåˆ™ä¼šé€‰æ‹©<strong>è‡³å°‘ä¸€ä¸ª</strong>ç»§ç»­å‘ä¸‹compactionï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥å¹¶å‘çš„ï¼Œå¦‚å›¾ï¼š</p>
<p><a href="/img/2023-9/L1.png" title="L1" class="gallery-item" style="box-shadow: none;"> <img src="/img/2023-9/L1.png" alt="L1"></a></p>
<p>æœ€å¤§çº¿ç¨‹æ•°æ˜¯ç”± <code>max_background_compactions</code>æ¥æ§åˆ¶çš„ã€‚</p>
<p>åœ¨ä»£ç å®ç°ä¸Šï¼Œcompactionçš„è§¦å‘æ˜¯ä¾èµ–è®¡ç®—<strong>åˆ†æ•°</strong>æ¥ç¡®å®šçš„ï¼š</p>
<ul>
<li><p>Score(L0) &#x3D; file_num &#x2F; max(<code>level0_file_num_compaction_trigger</code>, <code>max_bytes_for_level_base</code>)</p>
<p>è¿™ä¸¤ä¸ªéƒ½æ˜¯ç”±ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®çš„ï¼Œé¡¾åæ€ä¹‰ã€‚</p>
</li>
<li><p>Score(L&gt;0) &#x3D; total_file_size &#x2F; max_bytes_for_level</p>
</li>
</ul>
<p>ç»¼ä¸Šï¼ŒL0å±‚è§¦å‘compactionçš„ä¸»è¦æ¥æºå°±æ˜¯æ•°é‡è¶…é™ï¼ŒL&gt;0çš„è§¦å‘æ¥æºæ˜¯sizeè¶…é™ï¼Œå½“ç„¶ï¼Œä»¥leveldbä¸ºä¾‹ï¼Œè¿˜æœ‰å…¶ä»–è§¦å‘compactionçš„å…¥å£ï¼Œå¦‚ï¼š</p>
<ul>
<li><p>mutable memtable -&gt; imutable memtable -&gt; minor compaction</p>
</li>
<li><p>åœ¨Getæ¥å£ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶è¢«è®¿é—®å¤šæ¬¡éƒ½æ²¡å‘½ä¸­ï¼Œå°±ä¼šè§¦å‘compaction</p>
<ul>
<li>åœ¨æ¯æ¬¡getåˆ°æ•°æ®æ—¶ï¼Œä¼šå°†å…¶è®¿é—®çš„ä¸Šä¸€å±‚çš„ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯è®¿é—®çš„ä¸Šä¸€ä¸ªï¼‰æ–‡ä»¶çš„allowed_seeks - 1ï¼Œå½“allowed_seekså½’0æ—¶ï¼Œè§¦å‘compaction</li>
</ul>
</li>
<li><p>æ‰‹åŠ¨è§¦å‘</p>
</li>
</ul>
<p><strong>level file size</strong>çš„é€‰æ‹©</p>
<p>å¯ä»¥æ‰‹åŠ¨ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨ï¼ˆlevel_compaction_dynamic_level_bytesï¼‰ï¼Œæ®å®˜æ–¹è¯´æ¯ä¸€å±‚æ˜¯ä¸Šä¸€å±‚çš„10å€æœ€å¥½ã€‚</p>
<ul>
<li><p>level_compaction_dynamic_level_bytes &#x3D; false</p>
<p>æ­¤æ—¶éœ€è¦è®¾ç½®L0å±‚çš„sizeï¼ˆmax_bytes_for_level_base ï¼‰ï¼Œå€æ•°ï¼ˆmax_bytes_for_level_multiplierï¼‰ï¼Œæƒå€¼ï¼ˆmax_bytes_for_level_multiplier_additionalï¼‰ï¼Œè®¡ç®—å…¬å¼ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Target_Size(Ln+1) = Target_Size(Ln) * max_bytes_for_level_multiplier * max_bytes_for_level_multiplier_additional[n]`ã€‚`max_bytes_for_level_multiplier_additional</span><br></pre></td></tr></table></figure></li>
<li><p>level_compaction_dynamic_level_bytes &#x3D; true</p>
<p>æ­¤æ—¶éœ€è¦è®¾ç½®L0å±‚çš„sizeï¼ˆmax_bytes_for_level_base ï¼‰ï¼Œå±‚æ•°ï¼ˆnum_levelsï¼‰ï¼Œæœ€é«˜å±‚çš„sizeï¼ˆlevel n sizeï¼‰ï¼Œè®¡ç®—å…¬å¼ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Target_Size(Ln-1) = Target_Size(Ln) / max_bytes_for_level_multiplier</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-x-Sub-compaction"><a href="#1-x-Sub-compaction" class="headerlink" title="1.x Sub-compaction"></a>1.x Sub-compaction</h3><p><a href="/img/2023-9/subcompaction.png" title="subcompaction" class="gallery-item" style="box-shadow: none;"> <img src="/img/2023-9/subcompaction.png" alt="subcompaction"></a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/facebook/rocksdb/wiki/Subcompaction">å®˜æ–¹ä»‹ç»</a>è¯´çš„æœ‰ç‚¹æ¨¡ç³Šï¼Œå¯¹äºsub-compactionçš„è®¾è®¡æœ‰ç‰ˆæœ¬çš„è¿­ä»£ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº†<a target="_blank" rel="noopener" href="https://www.modb.pro/db/58495">è¿™ç¯‡åšå®¢</a>å…ˆè§£é‡Šå¤§æ¦‚åŸç†</p>
<p>v7.6ä¹‹å‰å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€‰ä¸­éœ€è¦compactionçš„L0ã€L1æ–‡ä»¶</li>
<li>ç”Ÿæˆå¹¶æ’åºboundsï¼Œå¦‚å›¾ï¼Œç”Ÿæˆåæ ¹æ®slice <strong>æ’åº</strong> å¹¶ <strong>å»é‡</strong> å¾—åˆ°å½¼æ­¤ç‹¬ç«‹çš„è¾¹ç•Œ</li>
</ol>
<p><a href="/img/2023-9/bound.png" title="bound" class="gallery-item" style="box-shadow: none;"> <img src="/img/2023-9/bound.png" alt="bound"></a></p>
<ol start="3">
<li>ç”Ÿæˆrangesï¼Œå¦‚å›¾ï¼Œå°†rangeçš„è¾¹ç•Œå’Œæ–‡ä»¶çš„æ€»å¤§å°ä¸€åŒä¿å­˜åˆ°RangeWithSizeï¼ŒåŒæ—¶è®¡ç®—æœ¬æ¬¡åˆå¹¶çš„æ€»æ•°æ®é‡sum</li>
</ol>
<p><a href="/img/2023-9/ranges.png" title="rangs" class="gallery-item" style="box-shadow: none;"> <img src="/img/2023-9/ranges.png" alt="rangs"></a></p>
<ol start="4">
<li><p>ç¡®å®šsubconpactionsï¼Œå¯ä»¥ç†è§£ä¸ºç”Ÿæˆå®é™…çš„ä»»åŠ¡æ•°é‡&#x2F;sub-compactionçš„çº¿ç¨‹æ•°ï¼Œæ®åšå®¢ä»‹ç»ï¼Œè¿™ä¸ªå€¼åŸºäºä¸‰ä¸ªå‚è€ƒå€¼ï¼š</p>
<ul>
<li>ç”¨æˆ·é…ç½®çš„max_subcompaction</li>
<li>ç¬¬3æ­¥çš„ranges.size()</li>
<li>è¿™é‡Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ä½œè€…ç¬”è¯¯ï¼Œä»–æƒ³å†™çš„å¯èƒ½æ˜¯max_output_files &#x3D; sum &#x2F; max_file_sizeï¼Ÿ</li>
</ul>
<p>ç»¼ä¸Šï¼š</p>
<p>subconpactions.size() &#x3D; min(max_subcompaction, ranges.size(), max_output_files)</p>
</li>
<li><p>ä»»åŠ¡åˆ†é…ï¼Œæ ¹æ®subconpactions.size()ç¡®å®šæ¯ä¸€ä¸ªçº¿ç¨‹åº”è¯¥åˆ†åˆ°å¤šå¤§çš„sizeï¼Œæ ¹æ®sizeåˆ’åˆ†æœ€ç»ˆçš„key rangeï¼Œç”Ÿæˆä»»åŠ¡ï¼Œäº¤ç»™compactionçº¿ç¨‹å»åšæ“ä½œ</p>
</li>
</ol>
<p>æ ¹æ®å®˜æ–¹çš„wikiæ‰€è¿°ï¼Œåœ¨v7.6ä¹‹åé‡‡ç”¨äº†ä¸€ç§åˆ†åŒºçš„é€»è¾‘(The logic for partitioning)æ¥ä¼˜åŒ–sub-compactionï¼Œå°†è¾“å…¥æ–‡ä»¶åˆ‡æˆæœ€å¤š128ä¸ªpartitionsï¼Œåœ¨æ‰§è¡Œä¸Šè¿°æ“ä½œ</p>
<h1 id="2-å†™å»¶è¿Ÿ-Write-stalls"><a href="#2-å†™å»¶è¿Ÿ-Write-stalls" class="headerlink" title="2. å†™å»¶è¿Ÿ(Write stalls)"></a>2. å†™å»¶è¿Ÿ(Write stalls)</h1><p>å®˜æ–¹çš„è¯´æ˜æ–‡æ¡£<a target="_blank" rel="noopener" href="https://github.com/facebook/rocksdb/wiki/Write-Stalls">åœ¨è¿™é‡Œ</a></p>
<ul>
<li>èƒŒæ™¯</li>
</ul>
<p>rocksdbåœ¨ä¸‹åˆ·æˆ–compactionæ— æ³•è·Ÿä¸Šå†™å…¥é€Ÿåº¦æ—¶ä¼šå—æ§å‡æ…¢å†™å…¥é€Ÿåº¦ï¼Œå¦‚æœä¸è¿™æ ·åšçš„è¯ä¼šé€ æˆç©ºé—´æ”¾å¤§å’Œè¯»æ”¾å¤§</p>
<p>è¿™ä¸¤ä¸ªæ”¾å¤§çš„ä¸»è¦æˆå› æ˜¯æ•°æ®æ²¡æœ‰åŠæ—¶çš„è¢«æ¨åˆ°æ›´é«˜å±‚ï¼Œå¯¼è‡´ç›¸åŒæ•°æ®çš„ä¸åŒç‰ˆæœ¬å¤§é‡å­˜åœ¨ï¼Œé€ æˆç©ºé—´æ”¾å¤§ï¼Œå„å±‚å°¤å…¶æ˜¯L0å±‚æ–‡ä»¶æ•°é‡å˜å¤šå¯¼è‡´äº†è¯»æ”¾å¤§ã€‚</p>
<p>å†™å»¶è¿Ÿçš„è§¦å‘æ£€æµ‹æ˜¯åˆ—æ—çº§åˆ«çš„ï¼Œä½†ä¸€æ—¦è§¦å‘å°±ä¼šå½±å“æ•´ä¸ªdbã€‚å½“è§¦å‘äº†å†™å»¶è¿Ÿæ—¶ï¼Œrocksdbå°†é€Ÿåº¦é™ä½åˆ°delayed_write_rateï¼ˆé€šå¸¸æ˜¯åœ¨å†™ä¹‹å‰sleep 1msï¼‰ï¼Œå½“æƒ…å†µå¾ˆç³Ÿç³•æ—¶ï¼Œå†™å…¥ä¼šä½äºè¿™ä¸ªå€¼ï¼Œç”šè‡³åœæ­¢å†™å…¥ã€‚</p>
<ul>
<li>å†™å»¶è¿Ÿçš„åŸå› </li>
</ul>
<ol>
<li><p>memtableå¤ªå¤š</p>
<p>rocksdbå…è®¸å¤šä¸ªmemtableå­˜åœ¨ï¼Œå…¶å®å°±æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šå…è®¸minor compactionå»¶è¿Ÿï¼Œä½†æ˜¯å½“immutable memtableè¿‡å¤šæ—¶ä¼šå ç”¨å†…å­˜ã€é™ä½æŸ¥æ‰¾æ•ˆç‡ï¼Œimmutable memtableçš„æœ€å¤§æ•°é‡å—åˆ°å‚æ•° <code>max_write_buffer_number</code>æ§åˆ¶ï¼Œå½“memtableæ•°é‡ä¸ºnï¼Œä¸” <code>max_write_buffer_number</code> &gt; 3æ—¶ï¼š</p>
<ul>
<li>3 &lt; n &lt; max_write_buffer_numberï¼Œæ­¤æ—¶ä¼šè¿›è¡Œå†™å»¶è¿Ÿ</li>
<li>n &gt;&#x3D; max_write_buffer_numberï¼Œæ­¤æ—¶ä¼šå†™åœæ­¢</li>
</ul>
</li>
<li><p>L0çš„æ–‡ä»¶è¿‡å¤š</p>
<p>å½“L0æ–‡ä»¶æ•°é‡è¾¾åˆ°å‚æ•° <code>level0_slowdown_writes_trigger</code>æ—¶ï¼Œä¼šè¿›è¡Œå†™å»¶è¿Ÿé™é€Ÿï¼Œå½“åˆ°è¾¾ <code>level0_stop_writes_trigger</code>æ—¶ï¼Œä¼šç›´æ¥åœæ­¢å†™å…¥ï¼Œç­‰å¾…L0-&gt;L1çš„compactionç»“æŸ</p>
</li>
<li><p>æœ‰å¤ªå¤šç­‰å¾…compactionçš„å­—èŠ‚</p>
<p>å½“ä¼°ç®—çš„compactionå­—èŠ‚åˆ°è¾¾ <code>soft_pending_compaction_bytes</code>æ—¶ï¼Œä¼šè¿›è¡Œå†™å»¶è¿Ÿï¼Œåˆ°è¾¾ <code>hard_pending_compaction_bytes</code>æ—¶ï¼Œä¼šå®Œå…¨åœæ­¢å†™å…¥</p>
</li>
</ol>
<ul>
<li>ç¼“è§£å†™å»¶è¿Ÿçš„æ–¹æ³•</li>
</ul>
<ol>
<li>å¦‚æœæ˜¯ä¸‹åˆ·å¼•èµ·çš„å†™å»¶è¿Ÿï¼š<ul>
<li>å¢å¤š <code>max_background_jobs</code>ï¼Œå¢å¤šä¸‹åˆ·çº¿ç¨‹æ•°</li>
<li>è°ƒå¤§memtableçš„æœ€å¤§æ•°é‡ï¼ˆ<code>max_write_buffer_number</code>ï¼‰ä»¥å‡å°immtable memtableçš„size</li>
</ul>
</li>
<li>å¦‚æœæ˜¯L0æ–‡ä»¶è¿‡å¤šæˆ–å¾…compactionçš„å­—èŠ‚å¤ªå¤šï¼š<ul>
<li>å¢å¤š <code>max_background_jobs</code>ï¼Œå¢å¤šä¸‹åˆ·çº¿ç¨‹æ•°</li>
<li>è°ƒå¤§ <code>write_buffer_size</code> ä»¥å¾—åˆ°æ›´å¤§çš„memtableæ¥å‡å°å†™æ”¾å¤§</li>
<li>è°ƒå¤§ <code>min_write_buffer_number_to_merge</code></li>
</ul>
</li>
</ol>
<p>å…¶ä»–çš„æ–¹æ³•å°±</p>
</div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-09-01</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« deadlinefen</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/RocksDB/'>
                            RocksDB
                        </a>
                    
                        <a href='/tags/compaction/'>
                            compaction
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E6%95%A3%E8%A3%85%E6%8A%80%E6%9C%AF/'>
                            æ•£è£…æŠ€æœ¯
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 Powered by deadlinefen, China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>æŒç»­åšæœ‰ç§¯ç´¯çš„äº‹æƒ…</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>


    <!--æš—é»‘æ¨¡å¼-->
    <script src="/js/darkmode-js.min.js"></script>
    <script>
        function addDarkmodeWidget() {
        const options = {
            bottom: '53px', // default: '32px'
            right: 'unset', // default: '32px'
            left: '42px', // default: 'unset'
            time: '0.3s', // default: '0.3s'
            mixColor: '#fff', // default: '#fff'
            backgroundColor: ' #e4e4e4 ',  // default: '#fff'
            buttonColorDark: '#100f2c',  // default: '#100f2c'
            buttonColorLight: '#fff', // default: '#fff'
            saveInCookies: true, // default: true,
            label: 'ğŸŒ“', // default: ''
            autoMatchOsTheme: true // default: true
        }
    
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
        
        }
        window.addEventListener('load', addDarkmodeWidget);
    </script>
  
</html>